(def input
  "                                                                                                                                                                         |                               
                 +---------------+           +-------------------+         +---+         +-----------------------------------------------------------------------------+ |       +-------------------+   
                 |               |           |                   |         |   |         |                                                                             | |       |                   |   
           +-----|---------------|-----------------------------------------|------R------|-----------+       +-----------------------+                       +-----+   | |       |                   |   
           |     |               |           |                   |         |   |         |           |       |                       |                       |     |   | |       |                   |   
           |     |               |           |                   +-----------------------|---+       |       |                 +-----+ +-+                   |     |   | | +-----|-------------------+   
           |     |               |           |                             |   |         |   |       |       |                 |       | |                   |     |   | | |     |                       
           |     |               |           |                   M-----------------------------------|-----+ |                 +-------|---------------+     |     |   +-+ |     |                   +-+ 
           |     |               |           |                             |   |         |   |       |     | |                         | |             |     |     |       |     |                   | | 
           |     |               | +---------|-----------------------------+   |         |   +-------|-------|-------------------------|-----------------------------------|-----|---------------------+ 
           |     |               | |         |                                 |         |           |     | |                         | |             |     |     |       |     |                   |   
           |   +-------------------+         |           +-------+             |         |         +---------|-------------------------|---------------|-------------------------|---+               |   
           |   | |               |           |           |       |             |         |         | |     | |                         | |             |     |     |       |     |   |               |   
           |   | |               |           |           |   +---|-------------|---------|---------|-|---------------------------------|-+       +-----+     |     |       |     |   |               |   
           |   | |               |           |           |   |   |             |         |         | |     | |                         |         |           |     |       |     |   |               |   
           |   | |               |           |           |   |   |             |       +-|---------|-|-----|-|-------------------------|-+       |           |     |       |     |   |               |   
           |   | |               |           |           |   |   |             |       | |         | |     | |                         | |       |           |     |       |     |   |               |   
           |   | |               |           |           |   |   |             |       | |         | |     | |       +-+ +-----------------------------------|---------+   |     |   |               |   
           |   | |               |           |           |   |   |             |       | |         | |     | |       | | |             | |       |           |     |   |   |     |   |               |   
           |   | |               +-----------------------|---|---|-------------|-------|-----------|-|-----|-|-------|-|-|-----------------------|-----------------|---|---|-----|---|---------------|-+ 
           |   | |                           |           |   |   |             |       | |         | |     | |       | | |             | |       |           |     |   |   |     |   |               | | 
           |   | |                           |           |   |   |             |       | |         | |     | |       | | |             | |       |           |     |   |   |     |   |               | | 
           |   | |                           |           |   |   |             |       | |         | |     | |       | | |             | |       |           |     |   |   |     |   |               | | 
           |   | |                     +-----|---------------------------+     |     +-|-----------|---------------------|---------------|-+     |   +-------|-------------|-+   | +-----+ +---+     | | 
           |   | |                     |     |           |   |   |       |     |     | | |         | |     | |       | | |             | | |     |   |       |     |   |   | |   | | |   | |   |     | | 
           |   | |                     +-----|-------------------|-------------+     | | |         | | +---|-|-------------------------|---------|---+       |     |   |   | +---|-+ |   | |   |     | | 
           |   | |                           |           |   |   |       |           | | |         | | |   | |       | | |             | | |     |           |     |   |   |     |   |   | |   |     | | 
           |   | |                           |   +-------|-----------+   |           | | |         | | |   | |       | | |             | | |     |           |     |   |   |     |   |   | |   |     | | 
           |   | |                           |   |       |   |   |   |   |           | | |         | | |   | |       | | |             | | |     |           |     |   |   |     |   |   | |   |     | | 
           |   | |                         +-|-----------|---|-------|-----------------|-----------|-------+ |       | | |             | | |     |           |     |   |   |     |   |   | |   |     | | 
           |   | |                         | |   |       |   |   |   |   |           | | |         | | |     |       | | |             | | |     |           |     |   |   |     |   |   | |   |     | | 
           |   | |         +-----------+   | |   |       |   |   |   |   |           | | |       +-|---------|---------|-----------------------+ |           |     |   |   |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |           | | |       | | | |     |       | | |             | | |   | |           |     |   |   |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |           | | |       | | | |     |       | | |           +-|-+ |   +-|-----------|-----|---+   |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |           | | |       | | | |     |       | | |           | |   |     |           |     |       |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |           | | |       | | | |     |       | | |           | |   |     |           |     |       |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |           | | |       | | | |     |       | | |           | |   |     |           |     |       |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |           | | |       | | | |     |       | | |           | |   |     |           |     |       |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |           | | |       | | | |     |       | | |           | |   |     |           |     |       |     |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |   +---------|-|-----------------------------|-|-------------+   |     |   +-------|-----------------+ |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   |   |   |   |       | | |       | | | |     |       | | |           |     |     |   |       |     |       |   | |   |   | |   |     | | 
           |   | |         |           |   +-|-----------------------|-------|---------|---------------------|-------|-|---+         |     |     |   |     +-+   +-------+ |   | |   |   | |   |     | | 
           |   | |         |           |     |   |       |   |   |   |   |   |       | | |       | | | |     |       | | | |         |     |     |   |     |     | |     | |   | |   |   | |   |     | | 
           |   | |         |           |   +-----|-------|---------+ |   |   |       | | |       | | | |     |       | | | |         |     |     |   |     |     | |     | |   | |   |   | |   |     | | 
           |   | |         |           |   | |   |       |   |   | | |   |   |       | | |       | | | |     |       | | | |         |     |     |   |     |     | |     | |   | |   |   | |   |     | | 
           |   | | +-------|-----------|-----|---------------|---|-|-----+   |   +-------------+ | | | |     |       | | | |         |     |     |   +-----|-+ +-|-+     +-|-+ | |   |   | |   +-----+ | 
           |   | | |       |           |   | |   |       |   |   | | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         | | | |   |   | |           | 
           |   | | |       |           |   | |   |       |   |   | | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         | | | |   |   | |           | 
           |   | | |       |           |   | |   |       |   |   | | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         | | | |   |   | |           | 
   +-+     |   +---|-+     |           |   | |   |       |   |   | | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         | | | |   |   | |           | 
   | |     |     | | |     |           |   | |   |       |   |   | | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         | | | |   |   | |           | 
 +---------------|-|-|-----|---------+ |   | |   | +---------|---+ | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         | | | |   |   | |           | 
 | | |     |     | | |     |         | |   | |   | |     |   |     | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         | | | |   |   | |           | 
 | | |     |     | | |     |         +-|-----|---|-|-----|-----------|-------|---|-------|-------|---|-|-----|-------|---|-|---------|-----------|-----------|---|---------|-+ | |   +---------------+ | 
 | | |     |     | | |     |           |   | |   | |     |   |     | |       |   |   | | |     | | | | |     |       | | | |         |     |     |         | | | |         |   | |       | |         | | 
 +-|-|-----|---------+ +---------------|---|-|---|-|-----|---|---+ +---+     |   |   | | |     | | | | |     |       | | | | +-------|---+ |     |         | | | |         | +-|-|-------|-|-------+ | | 
   | |     |     | |   |   |           |   | |   | |     |   |   |   | |     |   |   | | |     | | | | |     |       | | | | |       |   | |     |         | | | |         | | | |       | |       | | | 
   | |   +-------|---------------------|---|-------|---------|---|-----|-----|---|-----|-------|-|---|---------------|-----|---------------------|-----------|-|-----------|---|---+     | |       | | | 
   | |   | |     | |   |   |           |   | |   | |     |   |   |   | |     |   |   | | |     | | | | |     |       | | | | |       |   | |     H         | | | |         | | | | |     | |       | | | 
 +-+ +-----|---+ | |   |   |           |   | |   | |     |   |   |   | |     |   |   | | |     | | | | |     |       | | | | |       |   | |     |         | | | |         | | | | |     | |       +-+ | 
 |       | |   | | |   |   |           |   | |   | |     |   |   |   | |     |   |   | | |     | | | | |     |       | | | | |       |   | |     |         | | | |         | | | | |     | |           | 
 |   +---|-----|---+   |   |           |   | |   | |     | +-|-------|-|-+   |   |   | | |     | | | | |     |       | | | | |       |   | |     |         | | | |         | | | | |     | |           | 
 |   |   | |   | |     |   |           |   | |   | |     | | |   |   | | |   |   |   | | |     | | | | |     |       | | | | |       |   | |     |         | | | |         | | | | |     | |           | 
 |   |   | |   | |     |   |           |   | |   | |     | | |   |   | | |   |   |   | | |     | | | | |     |       | | | | |       |   | |     |   +-+   | | | |         | | | | |     | |       +-+ | 
 |   |   | |   | |     |   |           |   | |   | |     | | |   |   | | |   |   |   | | |     | | | | |     |       | | | | |       |   | |     |   | |   | | | |         | | | | |     | |       | | | 
 |   |   | |   | |     |   |           |   +-----|---------------|-----|-|-------|---|-|-------|-----|-------|---------------+       |   | |     |   | |   | | | |         | | | | |     | |       | | | 
 |   |   | |   | |     |   |           |     |   | |     | | |   |   | | |   |   |   | | |     | | | | |     |       | | | |         |   | |     |   | |   | | | |         | | | | |     | |       | | | 
 |   |   | |   | |     +---|------------E----+ +-+ |     | | |   |   | | |   |   |   | | |     | | | | | +-----------------|-----------+ | |     |   | |   | | | |         | | | | |   +-|-+       | | | 
 |   |   | |   | |         |           |       |   |     | | |   |   | | |   |   |   | | |     | | | | | |   |       | | | |         | | | |     |   | |   | | | |         | | | | |   | |         | | | 
 |   |   | |   | |         |           +-------|---|-----|-|-|-----------|-+ | +-|-----------------------|-----------|-|-------------|---|-------|-----|-------|-|-----------|---------+ +-------+ | | | 
 |   |   | |   | |         |                   |   |     | | |   |   | | | | | | |   | | |     | | | | | |   |       | | | |         | | | |     |   | |   | | | |         | | | | |             | | | | 
 |   |   | |   | |         |               +---|---|-------|-----------+ | | | | |   | +-|-------------+ |   |   +---|---|-|---------|-+ | |     |   | |   | | | |         | | | | |             | | | | 
 |   |   | |   | |         |               |   |   |     | | |   |   |   | | | | |   |   |     | | | |   |   |   |   | | | |         |   | |     |   | |   | | | |         | | | | |             | | | | 
 |   |   | |   | |         |               |   |   |     | | |   |   |   | | | | |   |   |     | | | |   |   |   |   | | | |         |   | |     |   | |   | | | |         | | | | |             | | | | 
 |   |   | |   | |         |               |   |   |     | | |   |   |   | | | | |   |   |     | | | |   |   |   |   | | | |         |   | |     |   | |   | | | |         | | | | |             | | | | 
 |   |   | |   | |         |               +-------|-----|-|-|-----+ |   | | | | |   |   |     | | | |   |   |   |   | | | |         |   | |   +-+   | |   | | | |         | | | | |             | | | | 
 |   |   | |   | |         |                   |   |     | | |   | | |   | | | | |   |   |     | | | |   |   |   |   | | | |         |   | |   |     | |   | | | |         | | | | |             | | | | 
 |   |   | |   | +-+       |                 +-----|-------------|---------|---|-|---|---|-----+ | | |   |   |   |   | | | |         |   | |   |     | |   | | | |         | | | | |             | | | | 
 |   |   | |   |   |       |                 | |   |     | | |   | | |   | | | | |   |   |       | | |   |   |   |   | | | |         |   | |   |     | |   | | | |         | | | | |             | | | | 
 |   |   | |   |   |       |               +-|-|-----------|-------------|-----------|---|-------|-|-|---|---|---|---|-----------+   |   | |   |     | |   | | | |         | | | | |             | | | | 
 |   |   | |   |   |       |               | | |   |     | | |   | | |   | | | | |   |   |       | | |   |   |   |   | | | S     |   |   | |   |     | |   | | | |         | | | | |             | | | | 
 +-------|-|---|---|-------------------------|-|---|-----|-----------|---|-----+ +---|-----------|-|-----|---+   |   +-|-----+   +---|---|-----------|---------|-|---------|-----|-|---------+   | | | | 
     |   | |   |   |       |               | | |   |     | | |   | | |   | | |       |   |       | | |   |       |     | | | |       |   | |   |     | |   | | | |         | | | | |         |   | | | | 
     | +-|-|---|---+       |               | | |   |     | | +-----|-------|---------+   |       | | |   |       |   +-|-|-+ |       |   | |   |     | |   | | | |         | | | | |         +-+ | | | | 
     | | | |   |           |               | | |   |     | |     | | |   | | |           |       | | |   |       |   | | |   |       |   | |   |     | |   | | | |         | | | | |           | | | | | 
     | | | |   |           |               | | |   |     | |     | | |   | | |           |       | | |   |       |   | | |   |       | +-|-------------------|---+ +---+   | | | | |           | | | | | 
     | | | |   |           |               | | |   |     | |     | | |   | | |           |       | | |   |       |   | | |   |       | | | |   |     | |   | | |   |   |   | | | | |           | | | | | 
     | | | |   |           |       +-------|-|-----|-------|-------|-|-----|-----------------------|-----|---+   +---|---|-----------|---|-----|-----|-|---|---|---|-------|-|-+ | |           | | | | | 
     | | | |   |           |       |       | | |   |     | |     | | |   | | |           |       | | |   |   |       | | |   |       | | | |   |     | |   | | |   |   |   | |   | |           | | | | | 
     | | | | +-|---+       |       |       | +-------------------|-|-|---+ | +-----+   +-|-------|---|---------------|-|-|-----------|-|-|-|---|-------|---|-|-|-----------|---+ | |           | | | | | 
     | | | | | |   |       |       |       |   |   |     | |     | | |     |       |   | |       | | |   |   |       | | |   |       | | | |   |     | |   | | |   |   |   | | | | |           | | | | | 
     | | | | | |   |       |       |       | +-----|-----|-|-----|-|-|-----|---------+ | |       | | |   |   |   +-----------|-------|-----+ +---------------|-----|---|---|-----|-----+       | | | | | 
     | | | | | |   |       |       |       | | |   |     | |     | | |     |       | | | |       | | |   |   |   |   | | |   |       | | |   | |     | |   | | |   |   |   | | | | |   |       | | | | | 
     | | | | | |   |       |       |       | | |   |     | |     | | |     |       | | | |       | | | +-----|-------+ | |   |       | | |   | |     | |   | | |   |   |   | | | | |   |       | | | | | 
     | | | | | |   |       |       |       | | |   |     | |     | | |     |       | | | |       | | | | |   |   |     | |   |       | | |   | |     | |   | | |   |   |   | | | | |   |       | | | | | 
     | | | | | |   |       |       |       | | |   |     | |     | | |     |       | | | |       | | | | |   |   |     | |   |       | | |   | |     | |   | | |   |   |   | | | | |   |       | | | | | 
     | | | | | |   |       |       |       | | |   |     | |     | | |     |       | | | |       | | | | |   |   |     | |   |       | | |   | |     | |   | | |   |   |   | | | | |   |       | | | | | 
 +-------------|-------------------|-------|-|-------------+     | | |     |       | | | |       | | | | |   |   |     | |   |       | | |   | |     | |   | | +---|-+ | +-|-+ | | |   |       | | | | | 
 |   | | | | | |   |       |       |       | | |   |     |       | | |     |       | | | |       | | | | |   |   |     | |   |       | | |   | |     | |   | |     | | | | |   | | |   |       | | | | | 
 |   | | | | | |   |       |   +-----------|-|-----|-+   |       | | |     |       | | | |       | | | | |   |   |     | |   |       | | |   | |     | |   | |     | | | | |   | +-----|-----+ | | | | | 
 |   | | | | | |   |       |   |   |       | | |   | |   |       | | |     |       | | | |       | | | | |   |   |     | |   |       | | |   | |     | |   | |     | | | | |   |   |   |     | | | | | | 
 +---|-|-|-----------------|-+ |   |       | | +---|-----|-------|---------|-------|-|---------+ | | | +-|-------|-----+ |   |       | | |   | |     | |   | |     | | | | |   |   |   |     | | | | | | 
     | | | | | |   |       | | |   |       | |     | |   |       | | |     |       | | | |     | | | |   |   |   |       |   |       | | |   | |     | |   | |     | | | | |   |   |   |     | | | | | | 
     | | | | | |   |       | | +-------------|-----------|-------|---|-----|-------------------|---------|---|---|---------------------|----D----------------|-----|---|-------|---|---|-------|-+ | | | 
     | | | | | |   |       | |     |       | |     | |   |       | | |     |       | | | |     | | | |   |   |   |       |   |       | | |   | |     | |   | |     | | | | |   |   |   |     | |   | | | 
     | +-|-----------------|-|-----|-------|-------|-----------+ | | |     |       | | | +-----|-|-|-|-----------|-------|-------------|-----|-------|-|-----|-----|-|-----+ +-|---------------|-+ | | | 
     |   | | | |   |       | |     |       | |     | |   |     | | | |     |       | | |       | | | |   |   |   |       |   |       | | |   | |     | |   | |     | | | |   | |   |   |     | | | | | | 
   +-----|-|-|-----|-------|-|-------------|-|-----|-----|-------|-----------------|-|-------------|-----|---------+     |   |       +-|-------|-----------|---------|-|-|---+ |   |   |     | | | | | | 
   | |   | | | |   |       | |     |       | |     | |   |     | | | |     |       | | |       | | | |   |   |   | |     |   |         | |   | |     | |   | |     | | | |     |   |   |     | | | | | | 
   | |   | | | |   |       | |     |       | |     | |   |     | | | |     |   +---------------|-|---|-----------------------|---------|-|---|-|-----|-|-----------|-|-|-------|---------------|-+ | | | 
   | |   | | | |   |       | |     |       | |     | |   |     | | | |     |   |   | | |       | | | |   |   |   | |     |   |         | |   | |     | |   | |     | | | |     |   |   |     | |   | | | 
 +-|-----+ | | |   |   +---|-------|-------|-|-------|---------|-|---|---------|-----|-|-------|-|---|---------------------+ |         | |   | |     | |   | |     | | | |     |   |   |     | |   | | | 
 | | |     | | |   |   |   | |     |       | |     | |   |     | | | |     |   |   | | |       | | | |   |   |   | |     | | |         | |   | |     | |   | |     | | | |     |   |   |     | |   | | | 
 | | |     | | |   |   |   | |     | +-----|---------|---|-------|-----------------+ | |       | | | |   |   +-----|---------|-+ +-----|-|---|---------------------|---|-|---------|---|---------+ | | | 
 | | |     | | |   |   |   | |     | |     | |     | |   |     | | | |     |   |     | |       | | | |   |       | |     | | | | |     | |   | |     | |   | |     | | | |     |   |   |     | | | | | | 
 | | |     | | |   |   | +-|-------|-|-----|-|-------|---------|-|-|-------|---------|-|-------------|---|---------|-------|---|---------|-----|-----|-|---------------|-------|---+   |     | | | | | | 
 | | |     | | |   |   | | | |     | |     | |     | |   |     | | | |     |   |     | |       | | | |   |       | |     | | | | |     | |   | |     | |   | |     | | | |     |       |     | | | | | | 
 | +-+     | | |   |   | | | |     | |     | |     | |   +-----|---|-----------|-------|-------|-|-|-------------|-|-------|---|-------|-|-------------|-----|-----|-|-|---+   |       |     | | | | | | 
 |         | | |   |   | | | |     | |     | |     | |         | | | |     |   |     | |       | | | |   |       | |     | | | | |     | |   | |     | |   | |     | | | | |   |       |     | | | | | | 
 | +-+     | | |   |   | | | |   +-|-|-----|-------------------|-----|---------------------------|-|---+ | +---+ | |     | | | | |     | |   | |     | |   | |     | | | | |   |       |     | | | | | | 
 | | |     | | |   |   | | | |   | | |     | |     | |         | | | |     |   |     | |       | | | | | | |   | | |     | | | | |     | |   | |     | |   | |     | | | | |   |       |     | | | | | | 
 | | |     | | |   |   | | | |   | | |     | |     | |   +-----|-|-|-|-------+ +-----|---------|---+ | +-----+ | +-+ +---|-------------|-|---+ |     | |   | |     | | | | |   |       |     | | | | | | 
 | | |     | | |   |   | | | |   | | |     | |     | |   |     | | | |     | |       | |       | |   |   | | | |     |   | | | | |     | |     |     | |   | |     | | | | |   |       |     | | | | | | 
 | | |     | | |   |   | | | |   | | |     | |     | |   |     | | | |     | |       | |   +---|---------|---|-|-----|-----|-----|-------|-----+     | |   | |   +-+ | | | |   |       |     | | | | | | 
 | | |     | | |   |   | | | |   | | |     | |     | |   |     | | | |     | |       | |   |   | |   |   | | | |     |   | | | | |     | |           | |   | |   |   | | | |   |       |     | | | | | | 
 | | |     | | |   |   | | | |   | +-------|-|-----|-----|-----|-|---|-------|-------|-|---|-----|---|---------------|---|-|-+ | |     | +-----------|-----+ |   |   | | | |   |       |     | | | | | | 
 | | |     | | |   |   | | | |   |   |     | |     | |   |     | | | |     | |       | |   |   | |   |   | | | |     |   | |   | |     |             | |     |   |   | | | |   |       |     | | | | | | 
 | | |     | | +---|---|-|-|-|---------------|-----|-|---------|-|---|-----|-----------|-------|-----|-----|---|---------+ |   | |     |             | |     |   |   | | | |   |       |     | | | | | | 
 | | |     | |     |   | | | |   |   |     | |     | |   |     | | | |     | |       | |   |   | |   |   | | | |     |     |   | |     |             | |     |   |   | | | |   |       |     | | | | | | 
 | | |     | |     |   | | | |   |   |     | |     | |   |     | | | |     | |       | |   |   | |   |   | | | |     +-----------|-----+             | |     |   +-+ | | | |   |       |     | | | | | | 
 | | |     | |     |   | | | |   |   |     | |     | |   |     | | | |     | |       | |   |   | |   |   | | | |           |   | |                   | |     |     | | | | |   |       |     | | | | | | 
 | | |     | |     |   | | | |   |   |     | |   +---|---+     | | | |   +-|-|-------|-|---------|---|---------|-------+   |   | |                   | |     |     | | | | |   |       |     | | | | +-+ 
 | | |     | |     |   | | | |   |   |     | |   | | |         | | | |   | | |       | |   |   | |   |   | | | |       |   |   | |                   | |     |     | | | | |   |       |     | | | |     
 | | | +---|-|-+   |   | | | |   |   |     | |   | | |         | | | |   | | |       +-+   |   | |   | +-|-----|-------|---------|---------------------|-----------|-|-|-|-------------|-----|-----|-+   
 | | | |   | | |   |   | | | |   |   |     | |   | | |         | | | |   | | |             |   | |   | | | | | |       |   |   | |                   | |     |     | | | | |   |       |     | | | | |   
 | | | |   | | |   |   | | | |   |   |     | |   | | |         | | | |   | | |             |   | |   | | | | | |       |   |   | |                   | |     |     | | | | |   |       |     | | | | |   
 | | | |   | | |   |   | | | |   |   |     | |   | | |         | | | |   | | |             |   | |   | | | | | |       |   |   | |                   | |     |     | | | | |   |       |     | | | | |   
 | | | |   | | |   |   | | | |   |   |     | +---|-|-|---------|-|---------|-|-------------|---|-----|-----------------|---|-----|------------------U--------|-----|---|---|---|-------|-------|-|-+ |   
 | | | |   | | |   |   | | | |   |   |     |     | | |         | | | |   | | |             |   | |   | | | | | |       |   |   | |                   | |     |     | | | | |   |       |     | | |   |   
 | | | |   | | +---|-+ | | | |   |   |     |     | | |         | | | |   | | |         +-+ |   | |   | | | | | |       |   |   | |                   | |     |     | | | | |   |       |     | | | +-+   
 | | | |   | |     | | | | | |   |   |     |     | | |         | | | |   | | |         | | |   | |   | | | | | |       |   |   | |                   | |     |     | | | | |   |       |     | | | |     
 | | | |   | |   +-|-|-------|---|---|-----------|-|-+         | | | |   | | |         | | |   | |   | | | | | |       |   |   | |       +-----------|-|-----------|---|-------+       |     | | | |     
 | | | |   | |   | | | | | | |   |   |     |     | |           | | | |   | | |         | | |   | |   | | | | | |       |   |   | |       |           | |     |     | | | | |           |     | | | |     
 | | | |   | |   | | | | | | |   |   |     |     | |           | | | |   | | | +-------|-------+ |   | | | | | |       |   |   | |       |           | |     |     | | | | |           |     | | +-----+ 
 | | | |   | |   | | | | | | |   |   |     |     | |           | | | |   | | | |       | | |     |   | | | | | |       |   |   | |       |           | |     |     | | | | |           |     | |   |   | 
 | | | |   | |   +-----|-|-----------|-----|-----|-------------|-|-|-|---|-----------------------|---|-|-|---|-|-----------|---|---------|-------------------------|-|-|-|-+           |     | |   |   | 
 | | | |   | |     | | | | | |   |   |     |     | |           | | | |   | | | |       | | |     |   | | | | | |       |   |   | |       |           | |     |     | | | |             |     | |   |   | 
 | | | |   | |     | | +---|-|-------|-----+     | |           | | | |   | | | +---------|-----+ |   | | | | | |       |   |   | |       |           | |     |     +-|-|---------------|-----|-|---|---+ 
 | | | |   | |     | |   | | |   |   |           | |           | | | |   | | |         | | |   | |   | | | | | |       |   |   | |       |           | |     |       | | |             |     | |   |     
 | | | |   +-----+ | |   | | | +-|-----------+   | |           | | | |   +-+ |         | | |   | |   | | | | | +-------------+ +-+       |     +-----|-|---------+   | | |   +---------|-------|---+     
 | | | |     |   | | |   | | | | |   |       |   | |           | | | |       |         | | |   | |   | | | | |         |   | |           |     |     | |     |   |   | | |   |         |     | |         
 | | +---------------------------|-+ |   +---|---|-------------+ | | | +-------+       | | |   | |   | | | | |         |   | +-------------------------|---------|---+ | |   |         |     | |         
 | |   |     |   | | |   | | | | | | |   |   |   | |             | | | |     | |       | | |   | |   | | | | |         |   |             |     |     | |     |   |     | |   |         |     | |         
 | |   |     |   | | |   | +-----|-|-------------|---------+     | | +-|-----|-|---------------|-|---|---|-|-----------|-----------------------|-------------|---|-------|-------------|-----|-|-------+ 
 | |   |     |   | | |   |   | | | | |   |   |   | |       |     | |   |     | |       | | |   | |   | | | | |         |   |             |     |     | |     |   |     | |   |         |     | |       | 
 | |   |     |   | | |   |   | | | | +---|---+   +---------+     +-------------|-------|-|---------------|-|-----------|---|-----------------------+ | |     |   |     | |   |         |     | |       | 
 | |   |     |   | | |   |   | | | |     |         |               |   |     | |       | | |   | |   | | | | |         |   |             |     |   | | |     |   |     | |   |         |     | |       | 
 | |   |     |   +-------|-------|-|---------------|---------------|-----------|-----------|---|-|---|---|-|-|---------|-----------------------|---|-|-------|---------|-|---|---------------+ |     +-+ 
 | |   |     |     | |   |   | | | |     |         |               |   |     | |       | | |   | |   | | | | |         |   |             |     |   | | |     |   |     | |   |         |       |     |   
 | | +-|-----|-----|-----|-----|---------|-----+   | +-------------|---|-----|-|-------|-|-|---|-|---+ | | +-|---------------------------|-------------|-----------------|---------------------|-------+ 
 | | | |     |     | |   |   | | | |     |     |   | |             |   |     | |       | | |   | |     | |   |         |   |             |     |   | | |     |   |     | |   |         |       |     | | 
 | | | +-----|---+ | |   |   | | | |     |     |   +-|-----------+ +-+ | +-+ | |       | | |   | | +---|-|-----------------|-------------------+   | | |     |   |     | |   |         |       |     | | 
 | | |       |   | | |   |   | | | |     |     |     |           |   | | | | | |       | | |   | | |   | |   |         |   |             |         | | |     |   |     | |   |         |       |     | | 
 | | |   +---+   | | |   |   | | | |     |     |     |           |   | | | | +-+       | | |   +---|-+ +-------------------|-------------|---------|-|-|-----|---|-----|-----------------------|-----+ | 
 | | |   |       | | |   |   | | | |     |     |     |           |   | | | |           | | |     | | |   |   |         |   |             |         | | |     |   |     | |   |         |       |       | 
 | | |   +-------|-------------|---------------|-----------------------|-|-|-------------|-|-----|---|---|---|-------------------------------------|-|-|--------A|-----|-|-----------+ |       |       | 
 | | |           | | |   |   | | | |     |     |     |           |   | | | |           | | |     | | |   |   |         |   |             |         | | |     |   |     | |   |       | |       |       | 
 +---------------|-|---------|-|-|-------|-----|-----|---------------------------------|-|-|-----|-------|---|-------------|-------------------------|-----------+     +---------------|-------|-------+ 
   | |           | | |   |   | | | |     |     |     |           |   | | | |           | | |     | | |   |   |         |   |             |         | | |     |           |   |       | |       |         
   | |           | | |   |   | | | +-----------|-----------------|-----|-|-----------------|-----|---|-------|-------------------------------------|-+ |     |           |   |       | |       |         
   | |           | | |   |   | | |       |     |     |           |   | | | |           | | |     | | |   |   |         |   |             |         |   |     |           |   |       | |       |         
   | |           | | |   |   | | |       |     |     |           |   | | | |           | | |     | | |   |   |         |   |             |         |   |     |           |   |       | |       |         
   | |           | | |   |   | | |       |     |     |           |   | | | |           | | |     | | |   |   |         |   |             |         |   |     |           |   |       | |       |         
 +-|-|-----------------------------------------------|-----------|-----|---------------|-----------|-------------------------------+     |   +-+   |   |     |           |   |       | |       |         
 | | |           | | |   |   | | |       |     |     |           |   | | | |           | | |     | | |   |   |         |   |       |     |   | |   |   |     |           |   |       | |       |         
 | | |     +-----|-|-|---|---|---------------------------------------|-----------------|-|-|---------|---------------------|-------+     |   | |   |   | +-----------+   |   |       | |       |         
 | | |     |     | | |   |   | | |       |     |     |           |   | | | |           | | |     | | |   |   |         |   |             |   | |   |   | |   |       |   |   |       | |       |         
 | | +-----|--K--|-----------|-+ |       +-----|-----|-----------|-----|-|-|---------------------+ | |   | +---------------------------------|-|-------+ |   |       +---|---|-------|---------------+   
 | |       |     | | |   |   |   |             |     |           |   | | | |           | | |       | |   | | |         |   |             |   | |   |     |   |           |   |       | |       |     |   
 | |       |     | +-----|-------+             |     |           |   | | | |     +-----|-|-|-------|-------|---------------|-----------------|-|-------------|-----------+   |       | +-----+ |     |   
 | |       |     |   |   |   |                 |     |           |   | | | |     |     | | |       | |   | | |         |   |             |   | |   |     |   |               |       |       | |     |   
 | |     +-+     +-------|---|-----------------|-----------------|-----|---|-----|-----|-|-----------|-------|---------|---------+       |   | |   |     |   |               |       |       | |     |   
 | |     |           |   |   |                 |     |           |   | | | |     |     | | |       | |   | | |         |   |     |       |   | |   |     |   |               |       |       | |     |   
 | |     |           |   +---------------------|-----+           |   | | | |     |     | | |       | |   | +-|-----------------+ |       |   | |   |     +---|-----------+   |       | +-----|-------+   
 | |     |           |       |                 |                 |   | | | |     |     | | |       | |   |   |         |   |   | |       |   | |   |         |           |   |       | |     | |         
 | |     +-------------------|-----------------|---------------------|-|-|-|-----+     | +-+       +-----|---------+   |   |   | |       |   | |   |         |           |   |       | |     | |         
 | |                 |       |                 |                 |   | | | |           |             |   |   |     |   |   |   | |       |   | |   |         |           |   |       | |     | |         
 | |       +-----------------------------------|-------------------------------------------------------------|---------|---|-----------------|-----+         |           |   +-------+ |     | +-+       
 | |       |         |       |                 |                 |   | | | |           |             |   |   |     |   |   |   | |       |   | |             |           |             |     |   |       
 | |       |         |       |                 |                 |   | | | |           |             +---|---|-----|---+   |   | |       |   | |             |           |             |     |   |       
 | |       |         |       |                 |                 |   | | | |           |                 |   |     |       |   | |       |   | |             |           |             |     |   |       
 +---------+         +-------|---------------------------------------------|---------------------------------|-----+       |   | +-------+   | |             |           |             +-----|-+ |       
   |                         |                 |                 |   | | | |           |                 |   |             |   |             | |             |           |                   | | |       
   +-------------------------+                 |                 |   | | +-|-----------|-----------------|-----------------|---|---+         | |   +---------|-----------+                   | | |       
                                               |                 |   | |   |           |                 |   |             |   |   |         | |   |         |                               | | |       
                                               |                 |   | |   |           |               +---------------------------+         +-|W--+         | +---------------------------+ | | |       
                                               |                 |   | |   |           |               | |   |             |   |               |             | |                           | | | |       
                                               |         +-------|---+ +---+           +---------------+ +---+             +---+               +-------------------------------------------+ +-+ |       
                                               |         |       |                                                                                           | |                                 |       
                                               +---------+       +-------------------------------------------------------------------------------------------+ +---------------------------------+       
                                                                                                                                                                                                         ")

(def directions
  {:up [-1 0]
   :down [1 0]
   :left [0 -1]
   :right [0 1]})

(defn opposite-direction [direction]
  (case direction
    :up :down
    :down :up
    :left :right
    :right :left))

(loop [lines (clojure.string/split-lines input)
       [row column :as location] [1 (.indexOf (lines 1) "|")]
       direction :down
       visited []]
  (let [c (get (lines row) column)]
    (case c
      (\| \-) (recur lines (mapv + location (directions direction)) direction visited)

      \+ (let [neighbors (reduce-kv #(assoc %1 %2 (mapv + location %3)) {} (dissoc directions (opposite-direction direction)))
               neighbor (-> (filter (fn [[_ [row column]]] (not= (get (lines row) column) \space)) neighbors) first)
               next-location (-> neighbor second)
               next-direction (-> neighbor first)]
            (recur lines next-location next-direction visited))

      (if (<= (int \A) (int c) (int \Z))
        (recur lines (mapv + location (directions direction)) direction (conj visited c))
        (clojure.string/join visited)))))
